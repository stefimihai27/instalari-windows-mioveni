<script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
<script>
    // --- START LOGICA PAROLA SIMPLA ---
    // Această parte se execută prima, înainte de orice altceva
    const utilizatorCorect = "admin";
    const parolaCorecta = "admin2026";

    const inputUser = prompt("Utilizator:");
    const inputPass = prompt("Parolă:");

    if (inputUser !== utilizatorCorect || inputPass !== parolaCorecta) {
        alert("Acces interzis! Date incorecte.");
        window.location.href = "/"; // Îl trimite pe prima pagină dacă greșește
    }
    // --- END LOGICA PAROLA SIMPLA ---

    // 1. INIȚIALIZARE CMS
    CMS.init({
      config: {
        backend: {
          name: "github",
          repo: "stefimihai27/instalari-windows-mioveni",
          branch: "main",
          auth_type: "token"
        },
        load_config_file: false,
        display_url: "https://instalari-windows-mioveni.vercel.app",
        collections: [
          {
            name: "setari",
            label: "Setări Site",
            files: [
              {
                name: "home",
                label: "Pagina Principală",
                file: "index.html",
                fields: [
                  { label: "Titlu Hero", name: "hero_title", widget: "string" },
                  { label: "Telefon", name: "phone", widget: "string" },
                  { label: "Pret Basic", name: "price_basic", widget: "string" },
                  { label: "Pret Complet", name: "price_complet", widget: "string" }
                ]
              }
            ]
          }
        ]
      }
    });

    // 2. LOGICA DE NETLIFY IDENTITY
    // Deoarece folosim prompt-ul de mai sus, Identity rămâne doar ca o barieră secundară dacă e activat
    if (window.netlifyIdentity) {
        netlifyIdentity.on('init', user => {
            if (!user && !window.location.hash) { 
                // Dacă nu e logat prin Identity, forțăm deschiderea widget-ului
                netlifyIdentity.open();
            } else {
                document.getElementById('loading-screen')?.classList.add('hidden');
                document.getElementById('admin-content')?.classList.remove('hidden');
                document.getElementById('logout-btn')?.classList.remove('hidden');
                setTimeout(loadAdminDataFromCMS, 2000); 
            }
        });
    }

    // 3. FUNCȚII DE SALVARE CORECTATE
    function syncAndSave(fieldName, value) {
        window.CMS.getEditor().setFieldValue(fieldName, value);
        alert(`Valoarea pentru ${fieldName} a fost pregătită. Apasă butonul "Publish" din bara Decap pentru a finaliza salvarea pe site.`);
    }

    function savePrice(type) {
        const value = document.getElementById(`price-${type}`).value;
        const fieldMap = type === 'basic' ? 'price_basic' : 'price_complet';
        syncAndSave(fieldMap, value);
    }

    function savePhone() {
        const phone = document.getElementById('admin-phone').value;
        syncAndSave('phone', phone);
    }

    function loadAdminDataFromCMS() {
        try {
            const entry = window.CMS.getEntry('setari', 'home');
            if (entry) {
                const data = entry.get('data').toJS();
                if(data.price_basic) document.getElementById('price-basic').value = data.price_basic;
                if(data.price_complet) document.getElementById('price-complet').value = data.price_complet;
                if(data.phone) document.getElementById('admin-phone').value = data.phone;
            }
        } catch (e) {
            console.log("Se încarcă motorul CMS...");
        }
    }
</script>S
